<!doctype html>
<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../utils/utils.html">
<link rel="import" href="style-transformer.html">
<link rel="import" href="style-util.html">
<link rel="import" href="apply-shim.html">
<script>
(function() {
  'use strict';

  let StyleLib = {
    _prepareTemplate(template, tagname) {
      let cssText = '';
      template.content.querySelectorAll('style').forEach(s => {
        cssText += s.textContent;
        s.remove();
      });
      template._styleAst = Polymer.CssParse.parse(cssText);
      template._placeholder = Polymer.StyleUtil.applyStylePlaceHolder(tagname);
      Polymer.StyleTransformer.dom(template.content, tagname);
    },
    prepareHost(host, template) {
      if (!template._prepared) {
        this._prepareTemplate(template, host.localName);
        template._prepared = true;
      }
      Polymer.StyleTransformer.element(host, host.localName);
      let style = document.createElement('style');
      style.__cssRules = template._styleAst;
      style.__placeholder = template._placeholder;
      host.__style = style;
    },
    applyProperties(host) {
      let style = host.__style;
      style.textContent = Polymer.StyleTransformer.css(style.__cssRules, host.localName);
      Polymer.StyleUtil.applyStyle(style, null, style.__placeholder);
    }
  };
  Polymer.StyleLib = StyleLib;
})();
</script>
