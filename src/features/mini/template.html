<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>

  /**
   * Automatic template management.
   * 
   * The `template` feature locates and instances a `<template>` element
   * corresponding to the current Polymer prototype.
   * 
   * As of this writing, the `<template>` element must be immediately
   * preceeding the script that invokes `Polymer()`. This is not the final
   * API.
   *  
   * @class standard feature: template
   */
  
  using('Base', function(Base) {

    Base.addFeature({

      _prepTemplate: function() {
        var script = document._currentScript || document.currentScript;
        var prev = script && script.previousElementSibling;
        if (prev && prev.localName === 'template') {
          this._template = prev;
        }
      },

      _stampTemplate: function() {
        if (this._template) {
          // note: root is now a fragment which can be manipulated
          // while not attached to the element.
          this.root = this.instanceTemplate(this._template);
          // TODO(sjmiles): hello prollyfill
          if (window.CustomElements && CustomElements.upgradeSubtree) {
            CustomElements.upgradeSubtree(this.root);
          }
        }
      },

      instanceTemplate: function(template) {
        return document.importNode(template._content || template.content, true);
      }

    });

  });

</script>
