<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>

  using('Base', function(Base) {

    Base.addFeature({

      _bootTemplate: function() {
        var script = document._currentScript || document.currentScript;
        var prev = script && script.previousElementSibling;
        if (prev && prev.localName === 'template') {
          this._template = prev;
        }
      },

      stampTemplate: function() {
        // establishes this element as the current `host` 
        // so stamped elements can lookup host
        this._prepareStamping();
        if (this._template) {
          // note: root is now a fragment which can be manipulated
          // while not attached to the element.
          this.root = this.instanceTemplate(this._template);
          // TODO(sjmiles): hello prollyfill
          if (window.CustomElements && CustomElements.upgradeSubtree) {
            CustomElements.upgradeSubtree(this.root);
          }
        }
        // ensures dom is fully composed and attached to the element;
        // removes this element as the current `host`
        // after this, `this.root` points to the element itself.
        this._finishStamping();
      },

      instanceTemplate: function(template) {
        return document.importNode(template.content, true);
      }

    });

  });

</script>
