<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>

  Polymer.StyleCache = function() {
    this.cache = {};
  }

  Polymer.StyleCache.prototype = {
    
    MAX: 100,

    _prepare: function(style, scope, bag, styles) {
      style._scope = scope;
      style._styleProperties = bag;
      style._styles = styles;
    },

    store: function(is, style, scope, bag, styles) {
      this._prepare(style, scope, bag, styles);
      var s$ = this.cache[is] = this.cache[is] || [];
      s$.push(style);
      if (s$.length > this.MAX) {
        s$.shift();
      }
    },

    retrieve: function(is, properties, styles) {
      var cache = this.cache[is];
      if (cache) {
        for (var i=0, s; i < cache.length; i++) {
          s = cache[i];
          if (this._objectsEqual(properties, s._styleProperties) &&
            this._objectsEqual(styles,  s._styles)) {
            return s;
          }
        }
      }
    },

    // TODO(sorvell): intentionally a weak check here, good enough?
    _objectsEqual: function(target, source) {
      for (var i in target) {
        if (target[i] !== source[i]) {
          return false;
        }
      }
      return true;
    }

  };

</script>