<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>

(function() {

  /**

    Provides `ready` lifecycle callback which is called parent to child.

  */

  // TODO(sorvell): monkey patch for now.
  var originalAttachedCallback = Base.attachedCallback;

  Base.addFeature({

    // Checks if this element is inside another Polymer element. If so,
    // then pushes this element into an array of `_readyListeners`; if
    // not, starts the notify cascade.
    attachedCallback: function() {
      if (!this._readied) {
        var host = this.queryHost();
        if (host && !host._readied) {
          host._listenReady(this);
        } else {
          this._notifyReady();
        }
      }
      originalAttachedCallback.call(this);
    },

    _listenReady: function(element) {
      this._readyListeners = this._readyListeners || [];
      this._readyListeners.push(element);
    },

    _notifyReady: function() {
      //console.group('[' + this.name + '#' + this.id + ']', 'ready');
      this._ready();
      var n$ = this._readyListeners;
      if (n$) {
        for (var i=0, l=n$.length, n; (i<l) && (n=n$[i]); i++) {
          n._notifyReady();
        }
      }
      this._readyListeners = null;
      //console.groupEnd('[' + this.name + '#' + this.id + ']', 'ready');
    },

    _ready: function() {
      this._readied = true;
      this.ready();
    },

    // user extension point.
    ready: function() {}

  });

})();

</script>
