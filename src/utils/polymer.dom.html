<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>
(function() {

  // TODO(sorvell): figure out Polymer.dom compat...
  function decorateElement(e) {
    if (e.__polymerDecorated) {
      return e;
    }
    e.__polymerDecorated = true;

    e.observeNodes = function() {};

    e.unobserveNodes = function() {};

    e.deepContains = function(node) {
      if (this.contains(node)) {
        return true;
      }
      var n = node;
      var doc = node.ownerDocument;
      // walk from node to `this` or `document`
      while (n && n !== doc && n !== this) {
        // use logical parentnode, or native ShadowRoot host
        n = Polymer.dom(n).parentNode || n.host;
      }
      return n === this;
    };

    e.getOwnerRoot = function() {
      var n = this;
      while (n) {
        if (n.nodeType === Node.DOCUMENT_FRAGMENT_NODE && n.host) {
          return n;
        }
        n = n.parentNode;
      }
    };

  }

  function decorateEvent(e) {
    if (e.__polymerDecorated) {
      return e;
    }
    e.__polymerDecorated = true;
    e.rootTarget = e.path[0];
    Object.defineProperty(e, 'localTarget', {
      get: function() {
        return e.target;
      }
    });
    return e;
  }

  Polymer.dom = function(obj) {
    obj = obj || document;
    if (obj instanceof Event) {
      decorateEvent(obj);
    } else {
      //var obj = obj.shadowRoot || obj;
      decorateElement(obj);
      if (window.ShadyDOM) {
        ShadyDOM.patch(obj);
      }
      patchArrayMethods(obj);
    }
    return obj;
  };

  function patchArrayMethods(el) {
    ['querySelectorAll'].forEach(function(method) {
      var orig = el[method];
      el[method] = function() {
        return Array.from(orig.apply(this, arguments));
      }
    });
  }

  // TODO(sorvell): bc.
  Polymer.dom.flush = function() {
    if (window.ShadyDOM) {
      ShadyDOM.flush();
    }
  }

  Polymer.Settings = {
    useShadow: true
  };

})();
</script>
