<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>

  (function() {

    // Polymer is a Function, but of course this is also an Object, so we
    // hang various other objects off of Polymer.*

    var userPolymer = window.Polymer;

    window.Polymer = function(info, mixin) {
      // if input is a `class` (aka a function with a prototype), use the prototype
      // remember that the `constructor` will never be called
      var klass;
      if (typeof info === 'function') {
        klass = info;
      } else {
        klass = Polymer.Element(getNativeConstructor(info.extends));
        Polymer.Utils.extend(klass.prototype, info);
      }
      // support mixin for properties on ES6 classes...
      if (mixin) {
        Polymer.Utils.extend(klass.prototype, mixin);
      }
      if (klass.prototype.extends) {
        klass.extends = klass.prototype.extends;
      }
      Polymer.telemetry._registrate(klass.prototype);
      if (window.customElements) {
        return customElements.define(klass.prototype.is, klass);
      } else {
        return document.registerElement(klass.prototype.is, klass);
      }
    };

    var nativeConstructors = {};

    /**
     * Returns the native element constructor for the tag specified.
     *
     * @method getNativeConstructor
     * @param {string} tag  HTML tag name.
     * @return {Object} Native constructor for specified tag.
    */
    var getNativeConstructor = function(tag) {
      if (tag) {
        var c = nativeConstructors[tag];
        if (!c) {
          c = document.createElement(tag).constructor;
          nativeConstructors[tag] = c;
        }
        return c;
      } else {
        return HTMLElement;
      }
    }

    if (userPolymer) {
      for (var i in userPolymer) {
        Polymer[i] = userPolymer[i];
      }
    }

    //Polymer.Class = desugar;

  })();

  /*
  // Raw usage
  [ctor =] Polymer.Class(prototype);
  document.registerElement(name, ctor);

  // Simplified usage
  [ctor = ] Polymer(prototype);
  */

  // telemetry: statistics, logging, and debug

  Polymer.telemetry = {
    registrations: [],
    _regLog: function(prototype) {
      console.log('[' + prototype.is + ']: registered')
    },
    _registrate: function(prototype) {
      this.registrations.push(prototype);
      Polymer.log && this._regLog(prototype);
    },
    dumpRegistrations: function() {
      this.registrations.forEach(this._regLog);
    }
  };

</script>
