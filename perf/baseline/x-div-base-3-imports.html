<!doctype html>

<script src="../../perf-lib/perf.js"></script>

<style>
  x-div {
    display: block;
    border: 1px solid red;
    padding: 1px;
    margin: 1px;
  }
</style>

<script>

  Base = {

    // (semi-)pluggable features for Base
    _features: [],

    addFeature: function(feature) {
      /*
      this._features.push(feature);
      extend(Base, feature);
      delete Base.init;
      delete Base.register;
      */
    },

    registerCallback: function() {
      // `this` context is a prototype, not an instance
      var prototype = this;
      prototype._template = 
        document.currentScript.ownerDocument.querySelector('template');
      this.registerFeatures(prototype);
      this.registered(prototype);
    },

    registered: function(prototype) {
      // for overriding
    },

    registerFeatures: function(prototype) {
      Base._features.forEach(function(f) {
        f.register && f.register(prototype);
      }, this);
    },

    createdCallback: function() {
      this.root = this;
      this.beforeCreated();
      this.initFeatures();
      this.created();
      this.afterCreated();
    },

    beforeCreated: function() {
      // for overriding
    },

    initFeatures: function() {
      Base._features.forEach(function(f) {
        f.init && f.init.call(this);
      }, this);
    },

    created: function() {
      // for overriding
    },

    afterCreated: function() {
      // for overriding
    },


    attachedCallback: function() {
      // reserved for canonical behavior
      this.attached();
    },

    attached: function() {
      // for overriding
    },

    dettachedCallback: function() {
      // reserved for canonical behavior
      this.dettached();
    },

    dettached: function() {
      // for overriding
    },

    attributeChangedCallback: function() {
      // reserved for canonical behavior
      this.attributeChanged.apply(this, arguments);
    },

    attributeChanged: function() {
      // for overriding
    }
    
  };

  Base.__proto__ = HTMLElement.prototype;

  Polymer = function(prototype) {
    prototype.__proto__ = Base;
    document.registerElement(prototype.name, {prototype: prototype});
  };

  Polymer({
    name: 'x-div'
  });

</script>

<link rel="import" href="../../polymer/src/features/log.html">
<link rel="import" href="../../polymer/src/features/template.html">
<link rel="import" href="../../polymer/src/features/nodes.html">
<link rel="import" href="../../polymer/src/features/events.html">
<link rel="import" href="../../polymer/src/features/keys.html">
<link rel="import" href="../../polymer/src/features/content.html">
<link rel="import" href="../../polymer/src/features/attributes.html">
<link rel="import" href="../../polymer/src/features/bind.html">
<link rel="import" href="../../polymer/src/features/annotations.html">
<link rel="import" href="../../polymer/src/features/bind-annotations.html">
<link rel="import" href="../../polymer/src/features/content.html">
<link rel="import" href="../../polymer/src/features/utils.html">
<link rel="import" href="../../polymer/src/features/layout.html">

<body>

<script>console.perf();</script>

<script>

  var frag = document.createDocumentFragment();
  for (var i=0; i<1000; i++) {
    frag.appendChild(document.createElement('x-div'));
  }
  document.body.appendChild(frag);

</script>

<script>console.perfEnd();</script>

</body>