<!doctype html>
<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <meta charset="utf-8">
  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>
  <link rel="import" href="../../polymer.html">
  <link rel="import" href="scoped-styling-elements.html">
</head>
<body>

  <div class="scoped">no margin</div>

  <x-styled>
    <div class="content">Content</div>
  </x-styled>

  <x-styled class="wide"></x-styled>

<script>

  suite('scoped-styling', function() {
    var styled = document.querySelector('x-styled');
    var styledWide = document.querySelector('x-styled.wide');
    var unscoped = document.querySelector('.scoped');

    function assertComputed(element, value) {
      var computed = getComputedStyle(element);
      assert.equal(computed['border-top-width'], value, 'computed style incorrect');
    }

    test(':host, :host(...)', function() {
      assertComputed(styled, '1px');
      assertComputed(styledWide, '2px');
      
    });

    test('scoped selectors, simple and complex', function() {
      assertComputed(styled.$.simple, '3px');
      assertComputed(styled.$.complex1, '4px');
      assertComputed(styled.$.complex2, '4px');
    });

    test('media query scoped selectors', function() {
      assertComputed(styled.$.media, '5px');
    });

    test('upper bound encapsulation', function() {
      assertComputed(unscoped, '0px');
    });

    test('lower bound encapsulation', function() {
      assertComputed(styled.$.child.$.simple, '0px');
      assertComputed(styled.$.child.$.complex1, '0px');
      assertComputed(styled.$.child.$.complex2, '0px');
      assertComputed(styled.$.child.$.media, '0px');
    });

    test('::content selectors', function() {
      var content = document.querySelector('.content');
      assertComputed(content, '6px');
    });

    test('::shadow selectors', function() {
      assertComputed(styled.$.child.$.shadow, '7px');
    });

    test('/deep/ selectors', function() {
      assertComputed(styled.$.child.$.deep, '8px');
    });

    test('dynamically added elements', function() {
      var d = document.createElement('div');
      d.classList.add('scoped');
      styled.localDom.appendChild(d);
      assertComputed(d, '4px');
      styled.localDom.removeChild(d);
      assert.equal(d.className, 'scoped');
    });
    
  });

</script>
</body>
</html>
