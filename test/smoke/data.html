<!doctype html>
<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <title>Polymer - setProperties</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>

  <link rel="import" href="../../src/properties/data.html">
  <link rel="import" href="../../src/attributes/attribute-to-property.html">

</head>
<body>

  <template id="x-template">
    <style>
      :host {
        display: block;
        background: beige;
        padding: 8px;
        margin: 4px;
      }
      td:first-of-type {
        background: lightgray;
      }
    </style>
    <table>
      <tr><td foo$="{{foo}}" title="{{foo}}">foo:</td><td>{{foo}}</td></tr>
      <tr><td>concat(ziz, foo):</td><td>{{concat(ziz, foo)}}</td></tr>
      <tr><td>compound ziz, concat:</td><td>{{ziz}} - {{concat(ziz, foo)}}</td></tr>
      <tr><td>bar (computed):</td><td>{{bar}}</td></tr>
      <tr><td>nard (computed below):</td><td>{{nard}}</td></tr>
    </table>
    <x-client foo="{{foo}}" ziz="{{ziz}}" bar="{{bar}}" nard="{{nard}}" nard2="{{nard}}" nug="{{nug}}"></x-client>
  </template>

  <template id="x-client">
    <style>
      :host {
        display: block;
        background: lightblue;
        padding: 8px;
        margin: 4px;
      }
    </style>
    <table>
      <tr><td>foo:</td><td><input value="{{foo::input}}"></td></tr>
      <tr><td>ziz:</td><td><input value="{{ziz::input}}"></td></tr>
      <tr><td>bar:</td><td><input value="{{bar}}" disabled></td></tr>
      <tr><td>nard (computed):</td><td><input value="{{nard}}" disabled></td></tr>
    </table>
  </template>

  <script>
  (function() {
    'use strict';

    var logEl = window.logEl = function(el) {
      return el.localName + (el.id ? '#' + el.id : '');
    };

    var template = document.querySelector('template#x-template');

    class XHost extends HTMLElement {

      createdCallback() {
        var dom = Polymer.Data.stamp(template, this);
        this.createShadowRoot().appendChild(dom);
        //this.attachShadow({mode: 'open'}).appendChild(dom);
        Polymer.Data.configureProperties(this, {
          foo: Polymer.AttributeToProperty.valueForAttribute(this, 'foo') || 'foo',
          ziz: Polymer.AttributeToProperty.valueForAttribute(this, 'ziz') || 'ziz'
        }, template);

        if (this.hasAttribute('runtime')) {
          Polymer.Data.addPropertyEffect(this, 'foo', {
            fn: function() {
              console.log(logEl(this), 'custom2', arguments);
            }
          });
        }

      }

      zizChanged(value) {
        console.log(logEl(this), 'zizChanged', value);
      }

      fooChanged(value) {
        console.log(logEl(this), 'fooChanged', value);
      }

      computeBar(foo, ziz) {
        console.log(logEl(this), 'computeBar');
        return '[ ' + foo + ' - ' + ziz + ' ]';
      }

      barChanged(value) {
        console.log(logEl(this), 'barChanged', value);
      }

      stuffChanged(foo, ziz) {
        console.log(logEl(this), 'stuffChanged', foo, ziz);
      }

      concat(a, b) {
        return a + ' ' + b;
      }

      nardChanged(value) {
        console.log(logEl(this), 'nardChanged', value);
      }

      nugChanged(value) {
        console.log(logEl(this), 'nugChanged', value);
      }

    }

    Polymer.Data.createReadOnlyProperty(XHost, 'ziz');
    Polymer.Data.createReflectedProperty(XHost, 'ziz');
    Polymer.Data.createObserver(XHost, 'ziz', 'zizChanged');
    Polymer.Data.createObserver(XHost, 'foo', 'fooChanged');
    Polymer.Data.addPropertyEffect(XHost, 'foo', {
      fn: function() {
        console.log(logEl(this), 'custom', arguments);
      }
    });

    Polymer.Data.createNotifyingProperty(XHost, 'foo');
    Polymer.Data.createComputedProperty(XHost, 'bar', 'computeBar(foo, ziz)');
    Polymer.Data.createObserver(XHost, 'bar', 'barChanged');
    Polymer.Data.createMultiObserver(XHost, 'stuffChanged(foo, ziz)');

    Polymer.Data.createObserver(XHost, 'nard','nardChanged');
    Polymer.Data.createObserver(XHost, 'nug', 'nugChanged');

    Polymer.Data.bindTemplate(XHost, template);

    document.registerElement('x-host', XHost);

    // ---------------

    var clientTemplate = document.querySelector('template#x-client');

    class XClient extends HTMLElement {

      createdCallback() {
        var dom = Polymer.Data.stamp(clientTemplate, this);
        this.createShadowRoot().appendChild(dom);
        //this.attachShadow({mode: 'open'}).appendChild(dom);
        Polymer.Data.configureProperties(this, {
          foo: Polymer.AttributeToProperty.valueForAttribute(this, 'foo') || 'foo',
          ziz: Polymer.AttributeToProperty.valueForAttribute(this, 'ziz') || 'ziz',
          bar: Polymer.AttributeToProperty.valueForAttribute(this, 'bar') || 'bar',
          nug: Polymer.AttributeToProperty.valueForAttribute(this, 'nug') || 'nug'
        }, clientTemplate);
      }

      zizChanged(value) {
        console.log(logEl(this), 'zizChanged', value);
      }

      fooChanged(value) {
        console.log(logEl(this), 'fooChanged', value);
      }

      stuffChanged(foo, ziz) {
        console.log(logEl(this), 'stuffChanged', foo, ziz);
      }

      barChanged(value) {
        console.log(logEl(this), 'barChanged', value);
      }

      computeNard(bar) {
        console.log(logEl(this), 'computeNard');
        return '<< ' + bar + ' >>';
      }

      nardChanged(value) {
        console.log(logEl(this), 'nardChanged', value);
        this.nug = '*' + this.nug;
        console.log(logEl(this), 'new nug value:', this.nug);
      }

      nard2Changed(value) {
        console.log(logEl(this), 'nard2Changed', value);
      }

      nugChanged(value) {
        console.log(logEl(this), 'nugChanged', value);
      }

    }

    Polymer.Data.createNotifyingProperty(XClient, 'foo');
    Polymer.Data.createNotifyingProperty(XClient, 'ziz');
    Polymer.Data.createObserver(XClient, 'ziz','zizChanged');
    Polymer.Data.createObserver(XClient, 'foo','fooChanged');
    Polymer.Data.createObserver(XClient, 'bar','barChanged');
    Polymer.Data.createMultiObserver(XClient, 'stuffChanged(foo, ziz)');
    Polymer.Data.createComputedProperty(XClient, 'nard', 'computeNard(bar)');
    Polymer.Data.createObserver(XClient, 'nard','nardChanged');
    Polymer.Data.createObserver(XClient, 'nard2','nard2Changed');
    Polymer.Data.createNotifyingProperty(XClient, 'nard');
    Polymer.Data.createObserver(XClient, 'nug','nugChanged');
    Polymer.Data.createNotifyingProperty(XClient, 'nug');
    Polymer.Data.bindTemplate(XClient, clientTemplate);

    document.registerElement('x-client', XClient);

  })();
  </script>

  <x-host id="el1" runtime foo="foo-thing"></x-host>

  <!-- <x-client id="el2" foo="foo-attr"></x-client> -->

   <script>

    var logEl = window.logEl;

    var el1 = document.getElementById('el1');
    el1.addEventListener('foo-changed', function(e) {
      console.log(logEl(this), 'notified:', e.type,  e.detail);
    });
    // console.log('// setProperties(el1, {foo: \'foo2\', ziz: \'ziz2\'}');
    // Polymer.Data.setProperties(el1, {
    //   foo: 'foo2',
    //   ziz: 'ziz2'
    // });

    // console.log('---');

    // var el2 = document.getElementById('el2');
    // console.log('// setProperties(el2, {foo: \'foo\', ziz: \'ziz\'}');
    // Polymer.Data.setProperties(el2, {
    //   foo: 'foo',
    //   ziz: 'ziz'
    // });

    // console.log('---');

    // var el3 = document.getElementById('el3');
    // console.log('// el3.foo = \'foo\';');
    // el3.foo = 'foo';
    // console.log('// el3._setZiz(\'ziz\');');
    // el3._setZiz('ziz');

  </script>

</body>
</html>
