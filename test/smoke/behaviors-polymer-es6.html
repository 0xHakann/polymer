<!doctype html>
<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <title>Polymer - behaviors</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../polymer.html">
  <dom-module id="x-polymer">
    <template>
      <style>
        :host {
          display: block;
          background: beige;
        }
      </style>
      <div>{{behavior1Prop}}</div>
      <div>{{behavior2Prop}}</div>
    </template>
  </dom-module>
  <dom-module id="x-sub">
    <template>
      <style>
        :host {
          display: block;
          background: beige;
        }
      </style>
      <div>{{superProp}}</div>
      <div>{{subProp}}</div>
      <div>{{behavior1Prop}}</div>
      <div>{{behavior2Prop}}</div>
    </template>
  </dom-module>
    <script>
    (function() {
      'use strict';
      
      // *********************

      // working up to this...

      var behavior1 = {
        listeners: {
          tap: '_behavior1Tap'
        },

        hostAttributes: {
          overAttr: 'overAttr1',
          behavior1: 'behavior1'
        },

        properties: {
          behavior1Prop: {value: 'behavior1Prop', observer: '_behavior1PropChanged'},
          over: {value: 1}
        },

        observers: [
          '_behavior1Compute(behavior1Prop, over)'
        ],

        _behavior1Tap: function() {
          console.log('behavior1.tap');
        },

        _behavior1PropChanged: function(v) {
          console.log('_behavior1PropChanged:', v);
        },

        _behavior1Compute: function(a, b) {
          console.log('_behavior1Compute:', 'behavior1Prop', a, 'over', b);
        },

        ready: function() {
          console.log('behavior1.ready');
        },
        attached: function() {
          console.log('behavior1.attached');
        },
        attributeChanged: function(name) {
          if (name === 'foo') {
            console.log('behavior1.attributeChanged:', arguments);
          }
        },
        zonk: function(a) {
          console.log('behavior1.zonk');
        }
      };

      var behavior2 = {
        listeners: {
          tap: '_behavior2Tap'
        },

        hostAttributes: {
          overAttr: 'overAttr2',
          behavior2: 'behavior2'
        },

        properties: {
          behavior1Prop: {observer: '_behavior2_behavior1PropChanged'},
          behavior2Prop: {value: 'behavior2Prop', observer: '_behavior2PropChanged'},
          over: {value: 2}
        },

        observers: [
          '_behavior2Compute(behavior2Prop, over)'
        ],

        _behavior2Tap: function() {
          console.log('behavior2.tap');
        },

        _behavior2PropChanged: function(v) {
          console.log('_behavior2PropChanged:', v);
        },

        _behavior2_behavior1PropChanged: function(v) {
          console.log('_behavior2_behavior1PropChanged:', v);
        },

        _behavior2Compute: function(a, b) {
          console.log('_behavior2Compute:', 'behavior2Prop', a, 'over', b);
        },

        ready: function() {
          console.log('behavior2.ready');
        },
        attached: function() {
          console.log('behavior2.attached');
        },
        attributeChanged: function(name) {
          if (name === 'foo') {
            console.log('behavior2.attributeChanged:', arguments);
          }
        },
        zonk: function(a) {
          console.log('behavior2.zonk');
        }
      };

      class XPolymer extends HTMLElement {
        _tap() {
          console.log('xPolymer.tap');
        }

        _xPolymerPropPropChanged(v) {
          console.log('_xPolymerPropPropChanged:', v);
        }

        _xPolymerCompute(a, b) {
          console.log('_xPolymerCompute:', 'xPolymerProp', a, 'over', b);
        }
        
        ready() {
          console.log('x-polymer.ready');
          this.textContent = this.localName;
          this.listen(this, 'custom', '_custom');
          this.zonk(5);
        }

        attached() {
          console.log('x-polymer.attached');
        }

        attributeChanged(name) {
          if (name === 'foo') {
            console.log('x-polymer.attributeChanged:', arguments);
          }
        }

        zonk(a) {
          behavior1.zonk(a);
          behavior2.zonk(a);
          console.log('x-polymer.zonk');
        }

      }

      Polymer.Utils.mixin(XPolymer.prototype, {

        is: 'x-polymer',

        behaviors: [
          behavior1, 
          behavior2
        ],

        listeners: {
          tap: '_tap'
        },

        hostAttributes: {
          overAttr: 'overXPolymer',
          xPolymer: 'xPolymer'
        },

        properties: {
          xPolymerProp: {value: 'xPolymerProp', observer: '_xPolymerPropPropChanged'},
          over: {value: 3}
        },

        observers: [
          '_xPolymerCompute(xPolymerProp, over)'
        ]

      });

      Polymer(XPolymer);

      class Sup extends HTMLElement {

        superPropChanged(v) {
          console.log('superPropChanged:', v);
        }
        
        ready() {
          console.log('sup.ready');
          this.textContent = this.localName;
          this.zonk(5);
        }

        attached() {
          console.log('sup.attached');
        }

        zonk(a) {
          behavior1.zonk(a);
          console.log('sup.zonk');
        }
      }

      Polymer.Utils.mixin(Sup.prototype, {
        is: 'x-super',
        behaviors: [
          behavior1
        ],
        properties: {
          superProp: {value: 'superProp', observer: 'superPropChanged'}
        }
      });

      Polymer(Sup);

      class Sub extends Sup {
        
        subPropChanged(v) {
          console.log('subPropChanged:', v);
        }
        
        ready() {
          super.ready();
          console.log('sub.ready');
        }

        attached() {
          super.attached();
          console.log('sub.attached');
        }

        zonk(a) {
          super.zonk(a);
          behavior2.zonk(a);
          console.log('sub.zonk');
        }

      }

      Polymer.Utils.mixin(Sub.prototype, {
        is: 'x-sub',
        behaviors: [
          behavior2
        ],
        properties: {
          subProp: {value: 'subProp', observer: 'subPropChanged'}
        }
      });

      Polymer(Sub);

    })();
    </script>
  </dom-module>
</head>
<body>
  <x-polymer id="xPolymer"></x-polymer>
  <script>
  xPolymer.setAttribute('foo', 5);
  </script>
  <hr>
  <x-sub></x-sub>
</body>
</html>
