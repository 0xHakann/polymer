<!doctype html>
<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <title>Polymer - templatizer</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>

  <link rel="import" href="../../src/properties/batched-effects.html">
  <link rel="import" href="../../src/attributes/attribute-to-from-property.html">
  <link rel="import" href="../../src/template/template-stamp.html">
  <link rel="import" href="../../src/events/gesture-event-listeners.html">
  <link rel="import" href="../../src/templatizer/templatizer.html">

</head>
<body>

  <script>
  (function() {

    var data = new Polymer.BatchedEffects();
    var templatizer = new Polymer.Templatizer();

    class XTemplatizer extends HTMLElement {

      createdCallback() {
        this.prop = 0;
      }

      attachedCallback() {
        data.enablePropertyEffects(this);
        var template = this.querySelector('template');
        this.inst = templatizer.stamp(template, {
          fwdHostPropToInstance: (prop, value) => {
            // this.inst[prop] = value;
            this.inst.forwardProperty(prop, value);
          },
          fwdInstancePropToHost: (inst, prop, value) => {
            console.log('instance prop changed:', prop, value);
          },
          instanceProps: {
            inst: 'inst'
          }
        });
        this.parentNode.insertBefore(this.inst.root, this.nextSibling);
      }

    }

    document.registerElement('x-templatizer', XTemplatizer);

  })();

  </script>

  <template id="x-host">
    <x-templatizer>
      host: <input value="{{prop::input}}">
      <template>
        <div on-tap="handleTap">from host: <input value="{{prop::input}}"> {{compute(prop)}}</div>
        <div>instance: <input value="{{inst::input}}"></div>
      </template>
    </x-templatizer>
  </template>


  <script>
  (function() {

    var data = new Polymer.BatchedEffects();

    var template = document.querySelector('template#x-host');

    class XHost extends HTMLElement {

      createdCallback() {
        this.prop = 100;
      }

      attachedCallback() {
        var dom = data.stamp(template, this);
        this.createShadowRoot().appendChild(dom);
        data.enablePropertyEffects(this);
      }

      compute(prop) {
        return 'computed: ' + prop;
      }

      handleTap() {
        console.log('tapped');
      }

    }

    data.bindTemplate(XHost, template);
    document.registerElement('x-host', XHost);

  })();
  </script>

  <x-host></x-host>

</body>
</html>
