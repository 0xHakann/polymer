<script>

  Polymer({

    name: 'x-tabs',

    published: {
      index: {
        type: Number,
        notify: true
      }
    },

    listeners: {
      click: 'click'
    },

    bind: {
      selected: 'selectedChanged',
      // because `index` is published, it's setter acquires validation
      // and notification powers 
      index: 'indexChanged'
    },

    selectedChanged: function(selected, old) {
      this.attributeFollows('selected-tab', selected, old);
      // TODO(sjmiles): could be redundant
      this.index = Array.prototype.indexOf.call(this.children, selected);
    },

    indexChanged: function(index, old) {
      if (index < 0 || index >= this.children.length) {
        // TODO(sjmiles): validate by returning a value that !== undefined
        return old;
      } else {
        this.selected = this.children[index];
      }
    },

    click: function(e) {
      var t = e.target;
      if (t !== this) {
        while (t && t.parentNode !== this) {
          t = t.parentNode || t.host;
        }
        this.index = Array.prototype.indexOf.call(this.children, t);
      }
    }

  });

</script>
