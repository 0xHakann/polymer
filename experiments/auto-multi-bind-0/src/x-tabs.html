<script>

  Polymer({

    name: 'x-tabs',

    listeners: {
      click: 'click'
    },

    published: {
      selectable: String,
      index: Number
    },

    bind: {
      selected: 'selectedChanged'
    },

    click: function(e) {
      var t = e.target;
      if (t !== this) {
        if (this.selectable) {
          while (t && t !== this && t.localName !== this.selectable) {
            t = t.parentNode || t.host;
          }
        }
        this.selected = t;
        // TODO(sjmiles): this magic spot doesn't need to mess with index
        this.fire('property-changed', 'index');
      }
    },

    selectedChanged: function(selected, old) {
      if (old) {
        old.removeAttribute('selected');
      }
      if (selected) {
        selected.setAttribute('selected', '');
      }
    },

    setProperty: function(name, value) {
      if (name === 'index') {
        this.setIndex(value);
      }
    },

    setIndex: function(index) {
      // TODO(sjmiles): ignores 'selectable'
      this.selected = this.children[index];
    },
    
    set index(index) {
      this.setIndex(index);
      this.fire('property-changed', 'index');
    },

    get index() {
      // TODO(sjmiles): ignores 'selectable'
      return Array.prototype.indexOf.call(this.children, this._selected);
    }

  });

</script>
