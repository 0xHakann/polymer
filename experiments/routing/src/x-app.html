<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../polymer/data.html">

<link rel="import" href="../../../elements/elements.html">

<style>

  x-app {
    display: block;
  }

  x-app #pages2 {
    background-color: lightblue;
    margin: 320px;
  }

</style>
<template>

  <x-route id="main" route="{{pageName}}"></x-route>

  <x-pages selected="{{page}}" flex vertical layout on-click="pageClick">

    <paper-ripple flex center-center vertical layout>
      <span>One</span>
    </paper-ripple>

    <paper-ripple flex vertical layout>

      <x-route id="page2"></x-route>

      <x-pages id="pages2" selected="{{page2}}" flex vertical layout on-click="page2Click">
        <paper-ripple flex vertical center-center layout>Two/Bar</paper-ripple>
        <paper-ripple flex vertical center-center layout>Two/Zot</paper-ripple>
      </x-pages>

    </paper-ripple>

    <paper-ripple flex vertical center-center layout>
      <x-route id="page3" match=":userName"></x-route>
      <div id="notLoggedIn">Please login first.</div>
      <div id="loggedIn">Welcome <span>{{userName}}</span>!</div>
    </paper-ripple>

  </x-pages>

</template>
<script>
  Polymer({

    name: 'x-app',

    hostAttributes: 'vertical layout',
    
    bind: {
      pageName: 'pageNameChanged',
      page: 'pageChanged',
      page2: 'page2Changed',
      userName: 'userNameChanged'
    },

    created: function() {
      //var m = this.$.main.route;
      this.page = 0;
      this.page2 = 0;
      //this.$.main.setRoute('');
      //this.$.main.setRoute(m);
      this.$.main.retrieveRoute();
      console.log(this.pageName, this.squid);
    },

    pageNameChanged: function(pageName) {
      console.log('pageNameChanged: ', pageName);
      this.page = {'one': 0, 'two': 1, 'three': 2}[pageName] || 0;
    },

    pageChanged: function(page) {
      console.log('pageChanged: ', page);
      this.$.main.setRoute(['one', 'two', 'three'][page]);
    },

    page2Changed: function(page) {
      console.log('page2Changed: ', page);
      this.$.page2.setRoute(['bar', 'zot'][page]);
    },

    pageClick: function() {
      this.page = (this.page + 1) % 3;
    },

    page2Click: function(e) {
      e.stopPropagation();
      this.page2 = (this.page2 + 1) % 2;
    },

    userNameChanged: function() {
      this.$.notLoggedIn.hidden = Boolean(this.userName);
      this.$.loggedIn.hidden = !Boolean(this.userName);
    }

  });

</script>