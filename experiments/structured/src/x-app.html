<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../polymer/data.html">
<link rel="import" href="x-count.html">

<style>
  x-compose {
    display: block;
  }
</style>
<template>
  <x-count count="{{item.count}}" on-count-changed="notifyItemProperty"></x-count>
</template>
<script>
  Polymer({

    published: {
      item: Object
    },

    name: 'x-compose',

    notifyItemProperty: function() {
      this.fire('item-property-changed', this.item);
    }

  });
</script>

<style>
  x-uber-compose {
    display: block;
  }
</style>
<template>
  <x-compose item="{{item}}" on-item-property-changed="notifyItemProperty"></x-compose>
</template>
<script>
  Polymer({

    published: {
      item: Object
    },

    name: 'x-uber-compose',

    notifyItemProperty: function() {
      this.fire('item-property-changed', this.item);
    }

  });
</script>

<style>

  x-app {
    display: block;
    padding: 4px;
    border: 2px dotted silver;
  }
</style>

<template>
  
  <x-count id="a" count="{{item.count}}" on-count-changed="itemDoTheThing"></x-count>  
  <x-count id="b" count="{{item.count}}" on-count-changed="itemDoTheThing"></x-count>  

  <x-compose id="compose" item="{{item}}" on-item-property-changed="itemDoTheThing"></x-compose>
  <x-uber-compose id="compose2" item="{{item}}" on-item-property-changed="itemDoTheThing"></x-uber-compose>

  <div>{{item.count}}</div>
  <div>{{item.count}}</div>

</template>

<script>
  /*
  
  */

  Polymer({

    name: 'x-app',

    published: {

      item: Object

    },

    created: function() {
      this.item = {count: 5, user: {stuff: 1}};

      // TODO(sorvell): need null checking or this will error
      //this.a = {};
    },

    itemDoTheThing: function(e) {
      console.log('itemDoTheThing', e.target, e.target.count);
      requestAnimationFrame(function() {
        this._itemEffector();
        // sub-effectors! =(
        this.$.compose._itemEffector();
        this.$.compose2._itemEffector();

        this.fire('item-property-changed', this.item);
      }.bind(this));
    }

});

</script>

