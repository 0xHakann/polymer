<script>
/*
  When a property within an object valued property changes, we need to:

  Down: `effectObject`: process the side effect for the object, even though
  it has not changed. Ensure that any bound properties that are themselves
  object valued do the same.

  Up: `notifyObject`: fire the `name-property-changed` event.

  // TODO(sorvell): who exactly needs to notify up?

*/

  function isPublishedObject(prop) {
    return (this.published[prop].type === Object);
  }

  // effect object change _down_
  function effectObject(prop) {
    // down!!
    this['_' + prop + 'Effector']();
    // call sub-effectors
    this._bindListeners.forEach(function(info) {
      var node = info.id ? this.$[info.id] : this._nodes[info.index];
      if (isPublishedObject.call(node, info.property)) {
        // TODO(sorvell): recurse === iloop?
        effectObject.call(node, prop);
      }
    }, this);
  }

  function notifyObject(prop) {
    this.fire(prop + '-property-changed', this[prop], null, false);
  }

  // effect object change _down_ and _up_
  function effectNotifyObject(prop) {
    this.async(function() {
      effectObject.call(this, prop);
      notifyObject.call(this, prop);
    });
  }
</script>
