<link rel="import" href="../../../components/polymer/polymer.html">
<link rel="import" href="../../../components/polymer/data.html">
<link rel="import" href="observe.html">

<style>

  x-app {
    display: block;
    padding: 8px;
    line-height: 1.6em;
    border: 3px dotted silver;
  }

</style>

<template>

  <h2>Foo: <span>{{model.foo}}</span></h2>
  <button on-click="doStuff">Do Stuff</button>

</template>

<script>

  Polymer({

    name: 'x-app',

    published: {
      model: Object
    },

    bind: {
      model: 'modelChanged'
    },

    created: function() {
      this.model = {
        foo: 0
      };
    },

    modelChanged: function() {
      this.observe('model');
    },

    modelDataChanged: function() {
      // TODO(sjmiles): calls modelChanged which is not desired
      this._modelEffector();
      //alert("Action as a distance!\n`model.foo` is now " + this.model.foo);
    },

    doStuff: function() {
      this.model.foo = Math.random().toFixed(3);
    },

    observe: function(name) {
      if (!this.observers) {
        this.observers = [];
      }
      var observer = this.observers[name];
      if (observer) {
        observer.close();
      }
      observer = new ObjectObserver(this._data[name]);
      observer.open(this[name + 'DataChanged'].bind(this));
      this.observers[name] = observer;
    }

});

</script>