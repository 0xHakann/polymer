<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="x-count.html">
<link rel="import" href="x-template.html">

<style>

  x-ld {
    display: block;
  }

  x-ld #stuff > div {
    padding: 10px;
    margin: 10px;
    border: 1px solid black;
  }

  .detailView {
    border-left: 1px solid gray;
  }

  .padding {
    padding: 10px;
  }

</style>

<template>
  <div flex two vertical layout class="container">
    <h2 class="padding">List</h2>
    <div flex scroll class="padding" on-click="listClick"> 
      <template id="list" is="x-template" model="{{model}}">
        <section id="stuff">
          <x-count count="{{item.count}}"></x-count>      
          <div on-click="fromClick">{{item.from}}</div>
          <div>{{item.message}}</div>
          <div>{{item.timestamp}}</div>
          <hr>
        </section>

      </template>
    </div>
  </div>
  <div flex class="detailView padding">
    <h2>Detail</h2>
    <template id="detail" is="x-template" model="{{detail}}" on-modelchanged="detailModelChange">
      <section id="stuff">
        <x-count count="{{item.count}}"></x-count>      
        <div on-click="fromClick">{{item.from}}</div>
        <div>{{item.message}}</div>
        <hr>
      </section>

    </template>
    <template id="detail2" is="x-template" model="{{detail2}}" on-modelchanged="detailModelChange">
      <section id="stuff">
        <x-count count="{{item.count}}"></x-count>      
        <div>{{item.timestamp}}</div>
      </section>

    </template>

  </div>
</template>
<script>
(function() {

  // make some data
  var model = [];
  var count = 100;
  var aCode = 'A'.charCodeAt();
  for (var i=0; i<count; i++) {
    model.push({item: {
      count: i,
      from: String.fromCharCode(aCode + i % 26),
      message: 'ijfm',
      timestamp: new Date().toLocaleTimeString()
    }});
  }

  Polymer({

    name: 'x-ld',

    hostAttributes: 'horizontal layout',

    registerCallback: function() {
      Base.registerCallback.apply(this, arguments);
      XTemplate.fixTemplates(this._template);
    },

    created: function() {
      this.$.list.controller = this;
      this.$.detail.controller = this;
      this.model = model;
    },

    fromClick: function() {
      console.log('fromClick!');
    },

    listClick: function(e) {
      var model = this.$.list.getNodeModel(e.target);
      this.$.detail.model = model;
      this.$.detail2.model = this.$.detail.model;
      // TODO(sorvell): dirty checking is now preventing this?
      //this.detail = model;
      //this.detail2 = this.detail;
    },

    detailModelChange: function(e) {
      this.$.list.update(e.detail.model);
      this.$.detail.update();
      this.$.detail2.update();
    }

  });

})();
</script>