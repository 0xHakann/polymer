<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="x-count.html">
<link rel="import" href="x-template.html">

<style>

  x-app {
    display: block;
  }

  x-app #stuff > div {
    padding: 10px;
    margin: 10px;
    border: 1px solid black;
  }

  x-app li[selected] {
    background-color: green;
  }

</style>

<template id="my-template" is="x-template">
  <section id="stuff">
    <x-count count="{{item.count}}"></x-count>      
    <div on-click="fromClick">{{item.from}}</div>
    <div>{{item.message}}</div>
    <div>{{item.timestamp}}</div>
    <hr>
  </section>
</template>


<template>
  <x-count count="{{count}}"></x-count>
  <h2>Below is a template, stamping!</h2>
  <button on-click="toggleModel">Toggle Model</button>
  <template id="template" ref="my-template" is="x-template" model="{{templateModel}}" on-modelchanged="modelChangeHandler"></template>

  <h2>Above is a template, stamping!</h2>

</template>
<script>
(function() {

  var otherModel = [
    {
      item: {
        count: 1,
        from: 'Uno',
        message: 'ijfm',
        timestamp: new Date().toLocaleTimeString()
      }
    },
    {
      item: {
        count: 2,
        from: 'Duo',
        message: 'ijfm',
        timestamp: new Date().toLocaleTimeString()
      }
    },
    {
      item: {
        count: 3,
        from: 'Trio',
        message: 'ijfm',
        timestamp: new Date().toLocaleTimeString()
      }
    }
  ];

  Polymer({

    name: 'x-app',

    item: {
      count: 1,
      from: 'Hi!',
      message: 'ijfe',
      timestamp: new Date().toLocaleTimeString()
    },

    beforeCreated: function() {
      // TODO(sorvell): file template stamping bug
      // http://jsbin.com/xaludufemi/1/edit
      // var sub = this._template.content.querySelector('template');
      // this._ref = document.createDocumentFragment();
      // while (sub.content.firstChild) {
      //   this._ref.appendChild(sub.content.firstChild);
      // }
    },

    created: function() {
      this.$.template.controller = this;
      this.templateModel = this;
    },

    toggleModel: function() {
      if (this.templateModel !== this) {
        this.templateModel = this;
      } else {
        this.templateModel = otherModel;
      }
    },

    fromClick: function() {
      console.log('fromClick!');
    },

    modelChangeHandler: function(e, detail) {
      //console.log(e, detail);
      if (detail.path === 'item.count') {
        this.count = detail.value;
      }
    }

  });

})();
</script>