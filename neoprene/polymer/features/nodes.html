<script>

  // TODO(sjmiles): now depends on `annotations` and `bind-annotations` features

  Base.addFeature({

    $$: function(slctr) {
      return this.root.querySelector(slctr);
    },

    marshalNodeReferences: function() {
      this.$ = {};
      var map = this._template && this._template.map;
      if (map) {
        map.forEach(function(annotation) {
          var binding = annotation.bindings[0];
          if (binding.kind === 'id') {
            this.$[binding.value] = 
              this.findAnnotatedNode(this.root, annotation);
          }
        }, this);
      }
      /*
      for (var n in this.$) {
        this.$[n] = this._nodes[index];
      }
      */
      /*
      var n$ = this.root.querySelectorAll("[id]");
      if (n$.length) {
        // populate $ with id->node properties from the this.root subtree
        this.$ = {};
        for (var i=0, n; (n=n$[i]); i++) {
          // TODO(sjmiles): this node could come from another host 
          this.$[n.id] = n;
        }
      }
      */
    }

  });
  
</script>