<link rel="import" href="../../../../polymer/polymer.html">
<link rel="import" href="../../../../polymer/data.html">

<link rel="import" href="../../../elements.html">
<link rel="import" href="x-user.html">

<style>

  x-app {
    display: block;
  }

  x-app #pages2 {
    background-color: lightblue;
    margin: 320px;
  }

</style>
<template>

  <x-route id="routeA" match="{{pageName}}"></x-route>

  <div id="msg" style="padding: 4px;"></div>

  <x-pages selectedId="{{pageName}}" flex vertical layout on-click="pageClick">

    <paper-ripple id="one" flex center-center vertical layout>

      <span>One</span>

    </paper-ripple>

    <paper-ripple route="two" flex vertical layout>

      <x-route id="routeB" match="{{page2Name}}"></x-route>

      <x-pages id="pages2" selectedId="{{page2Name}}" flex vertical layout on-click="page2Click">

        <paper-ripple route="bar" flex vertical center-center layout>
          <h3>Two/Bar</h3>
          <x-user></x-user>
        </paper-ripple>

        <paper-ripple route="zot" flex vertical center-center layout>
          <h3>Two/Zot</h3>
          <x-user></x-user>
        </paper-ripple>

      </x-pages>

    </paper-ripple>

    <paper-ripple id="user" route="user" flex vertical center-center layout>

      <h3>User</h3>

      <x-route id="routeC" match="{{userName}}"></x-route>

      <div id="notLoggedIn">Please login first.</div>
      <div id="loggedIn">Welcome <span>{{userName}}</span>!</div>

      <x-user></x-user>

    </paper-ripple>

  </x-pages>

</template>
<script>
  Polymer({

    name: 'x-app',

    hostAttributes: 'vertical layout',

    bind: {
      pageName: 'pageNameChanged',
      page2Name: 'page2NameChanged',
      userName: 'userNameChanged'
    },

    created: function() {
      //this.pageName = 'one';
      //this.page2Name = 'bar';
      //this.userName = '';
      setInterval(function() {
        this.$.msg.innerHTML = 'Hamster wheel revolutions: <b>' + Base._telemetry._setDataCalls + '</b>';
      }.bind(this), 200);
    },

    pageClick: function() {
      var pages = ['one', 'two', 'user'];
      var i = pages.indexOf(this.pageName);
      this.pageName = pages[(i + 1) % 3];
    },

    page2Click: function(e) {
      e.stopPropagation();
      var pages = ['bar', 'zot'];
      var i = pages.indexOf(this.page2Name);
      this.page2Name = pages[(i + 1) % 2];
    },

    userNameChanged: function() {
      this.$.notLoggedIn.hidden = Boolean(this.userName);
      this.$.loggedIn.hidden = !Boolean(this.userName);
    },

    page2NameChanged: function(name) {
      if (!{bar: 1, zot:1}[name]) {
        this.page2Name = 'bar';
      }
    },

    pageNameChanged: function(name) {
      if (!{one: 1, two:1, user: 1}[name]) {
        this.pageName = 'one';
      }
    }

  });

</script>