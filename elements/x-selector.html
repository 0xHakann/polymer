<script>

  Polymer({

    name: 'x-selector',

    published: {
      selectable: String
    },
    
    bind: {
      'selected': 'selectedChanged'
    },

    listeners: {
      click: 'click'
    },

    selectedChanged: function(selected, old) {
      this.attributeFollows('selected', selected, old);
      //this.fire('selected-changed', null, null, false);
      // TODO(sjmiles): as constructed, we'd have to send this manually
      // because `index` is not a stored value
      this.fire('index-changed', null, null, false);
    },

    set index(index) {
      this.selected = this.items[index];
    },

    get index() {
      return this.items.indexOf(this.selected);
    },

    // TODO(sorvell): requires notification if items changes
    get items() {
      if (!this._items) {
        this._items = 
          Array.prototype.slice.call(this.querySelectorAll(this.selectable), 0)
      }
      return this._items;
    },

    click: function(e) {
      var t = e.target;
      if (t !== this) {
        if (this.selectable) {
          while (t && t !== this && t.localName !== this.selectable) {
            t = t.parentNode || t.host;
          }
        }
        this.selected = t;
      }
    }

  });

</script>
