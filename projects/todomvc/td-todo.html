<template>

  <div class="view">
    <input id="completed" class="toggle" type="checkbox">
    <label id="label"></label>
    <button id="remove" class="destroy"></button>
  </div>
  
  <input id="input" class="edit">

</template>

<script>

  Polymer({

    name: 'td-todo',

    hostAttributes: 'block',

    listeners: {
      'completed.change': 'completedChange',
      'remove.click': 'removeAction',
      'label.dblclick': 'editAction',
      'input.blur': 'commitAction'
    },
    
    keyPresses: {
      ENTER_KEY: 'commitAction'
    },

    bind: {
      item: 'itemChanged'
    },

    itemChanged: function(item) {
      if (item) {
        this.renderItem(item);
      }
    },

    renderItem: function(item) {
      this.$.completed.checked = item.completed;
      this.classList.toggle('completed', item.completed);
      this.$.input.value = item.value;
      this.$.label.textContent = item.value;
    },
    
    editAction: function() {
      this.classList.add('editing');
      this.$.input.focus();
    },
    
    commitAction: function() {
      this.classList.remove('editing');
      var v = this.$.input.value;
      if (v.length) {
        this.item.value = this.$.input.value;
        this.fire('item-change');
      } else {
        this.removeAction();
      }
    },

    completedChange: function(e) {
      this.item.completed = e.target.checked;
      this.fire('item-change');
    },

    removeAction: function() {
      this.fire('item-remove', this.item);
    }

  });

  TdToDo = function(item) {
    var e = document.createElement('td-todo');
    e.item = item;
    return e;
  };

</script>
